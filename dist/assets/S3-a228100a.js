import{b,y as t,bL as _,by as y,I as A,d2 as p,D as u,K as B,J as C,aa as I,b3 as v,bk as k,cq as F,d9 as J,q as K,da as L,S as q,bl as f,n as g,bR as N,ao as O}from"./index-8d006787.js";import{b as R}from"./useTitle-c9503954.js";import{G as T}from"./index-8b77d635.js";import{I as G}from"./SettingItem-49482dbf.js";import{R as H}from"./ResponsiveGrid-2c192e34.js";import{a as W}from"./FolderTree-5efebe3a.js";import{c as d}from"./index-fc8ed4bb.js";import"./index-fc0ca60d.js";import"./index-0e17f044.js";import"./item_type-32dc6fdf.js";const j=e=>{const s=b();return t(p,{w:"$full",overflowX:"auto",shadow:"$md",rounded:"$lg",p:"$2",direction:{"@initial":"column","@xl":"row"},spacing:"$2",get children(){return[t(_,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[t(y,{for:"path",display:"flex",alignItems:"center",get children(){return s("global.name")}}),t(A,{id:"name",get value(){return e.name},onChange:n=>e.onChange({...e,name:n.currentTarget.value})})]}}),t(_,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[t(y,{for:"path",display:"flex",alignItems:"center",get children(){return s("metas.path")}}),t(W,{id:"path",get value(){return e.path},onChange:n=>e.onChange({...e,path:n})})]}}),t(p,{direction:{"@initial":"row","@xl":"column"},justifyContent:{"@xl":"center"},spacing:"$1",get children(){return t(u,{colorScheme:"danger",onClick:async()=>{e.onDelete()},get children(){return s("global.delete")}})}})]}})},M=e=>{const s=b();return console.log(e.buckets),t(I,{alignItems:"start",w:"$full",get children(){return[t(y,{display:"flex",alignItems:"center",get children(){return s("settings.s3_buckets")}}),t(u,{onClick:()=>{e.setSettings(n=>n.key==="s3_buckets","value",JSON.stringify([...e.buckets,{name:"",path:""}])),console.log(e.buckets)},get children(){return s("global.add")}}),t(B,{get each(){return e.buckets},children:n=>t(j,C(n,{onChange:r=>{console.log(r),e.setSettings(a=>a.key==="s3_buckets","value",JSON.stringify(e.buckets.map(a=>a.name===n.name?r:a)))},onDelete:()=>{e.setSettings(r=>r.key==="s3_buckets","value",JSON.stringify(e.buckets.filter(r=>r.name!==n.name)))}}))})]}})},w=e=>{const s={...e.find(n=>n.key==="s3_buckets")};return s.value?JSON.parse(s.value):[]},te=()=>{const e=b();R("manage.sidemenu.s3");const[s,n]=v(()=>k.get("/admin/setting/list?group=".concat(T.S3))),[r,a]=F([]),m=async()=>{const c=await n();f(c,a)};m();const[$,x]=v(()=>k.post("/admin/setting/save",J(r))),[D,S]=K(!1);return t(I,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[t(H,{get children(){return[t(L,{each:r,children:(c,o)=>t(q,{get when(){return c().key!="s3_buckets"},get children(){return t(G,C(c,{onChange:i=>{a(l=>c().key===l.key,"value",i)},onDelete:async()=>{S(!0);const i=await k.post("/admin/setting/delete?key=".concat(c().key));S(!1),f(i,()=>{g.success(e("global.delete_success")),m()})}}))}})}),t(u,{onClick:()=>{const c=d.lib.WordArray.random(15),o=d.lib.WordArray.random(240/8),i=d.enc.Base64.stringify(c).replace(/[\r\n]/g,""),l=d.enc.Base64.stringify(o).replace(/[\r\n]/g,"");a(h=>h.key==="s3_access_key_id","value",i),a(h=>h.key==="s3_secret_access_key","value",l)},get children(){return e("settings.s3_generate")}}),t(N,{get children(){return e("settings.s3_restart_to_apply")}}),t(M,{get buckets(){return w(r)},setSettings:a})]}}),t(O,{spacing:"$2",get children(){return[t(u,{colorScheme:"accent",onClick:m,get loading(){return s()||D()},get children(){return e("global.refresh")}}),t(u,{get loading(){return $()},onClick:async()=>{const c=w(r),o=new Set;for(const l of c){if(l.name===""||l.path===""){g.error(e("settings.s3_buckets_empty"));return}if(o.has(l.name)){g.error(e("settings.s3_buckets_duplicate_name"));return}o.add(l.name)}const i=await x();f(i,()=>g.success(e("global.save_success")))},get children(){return e("global.save")}})]}})]}})};export{te as default};
